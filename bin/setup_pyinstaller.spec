# -*- mode: python ; coding: utf-8 -*-
# Setup specification file for Pyinstaller
"""Pyinstaller specification for freezing MagellanMapper and its environment.

Originally auto-generated by Pyinstaller, modified here to include
modules and packages not detected but required for MagellanMapper.

"""

import platform

from magmap.io import packaging
from magmap.settings import config
import setup as mag_setup

block_cipher = None

a = Analysis(
    ["../run.py"],
    pathex=[],
    binaries=[],
    datas=[
        # add full package folders since they contain many modules that
        # are dynamically discovered or otherwise not found by Pyinstaller
        *[packaging.get_pkg_path(p) for p in (
            "mayavi",
            "pyface",
            "traitsui",
            "tvtk",
            "bioformats",
            "javabridge",
        )],
        # add egg-info folders required for these packages' entry points
        *[packaging.get_pkg_egg(p) for p in (
            "mayavi",
            "pyface",
            "traitsui",
        )],
        # assume that Java Runtime Environment extracted by jlink is in
        # the parent directory of the project's directory and designated by
        # platform to accommodate JREs across platforms
        (f"../../jre_{platform.system().lower()}", "jre"),
    ],
    hiddenimports=[
        "sklearn.utils._weight_vector",
        "traits.util.clean_strings",
    ],
    hookspath=[],
    runtime_hooks=[],
    excludes=[],
    win_no_prefer_redirects=False,
    win_private_assemblies=False,
    cipher=block_cipher,
    noarchive=False)
pyz = PYZ(a.pure, a.zipped_data, cipher=block_cipher)
exe = EXE(
    pyz,
    a.scripts,
    [],
    exclude_binaries=True,
    name=mag_setup.config["name"],
    debug=False,
    bootloader_ignore_signals=False,
    strip=False,
    upx=True,
    console=False)
coll = COLLECT(
    exe,
    a.binaries,
    a.zipfiles,
    a.datas,
    strip=False,
    upx=True,
    upx_exclude=[],
    name="run")
app = BUNDLE(
    coll,
    name="{}.app".format(config.APP_NAME),
    icon=None,
    bundle_identifier=None,
    info_plist={
        "NSRequiresAquaSystemAppearance": False,
        "LSEnvironment": {
            # "./" at the start will be translated to the .app root directory
            # since the working directory is "/" rather than the app root
            "JAVA_HOME": "./../Resources/jre"
        }
    })
